## Настройки CRON через консоль

> **Команда для просмотра файла Cron:**  
> `crontab -l -uigorcomputer`  - указывается под каким пользователем смотрим  

Существует система разделения прав на уровне CRON для каждого пользователя.  
Т.е. каждый пользователь при команде редактирования или просмотра файла crontab будет видеть   
содержимое только своего файла. Поэтому, чтобы редактировать файл crontab необходимо указывать пользователя  

> При запуске команды откроется редактор, в котором, возможно, уже будут описаны команды для Cron:  
> 
```bash 
01      02      *       *       *       /home/public_html/script.sh
*/20    *       *       *       *       /home/public_html/demo.sh
```

> `service crond status` — просмотр статуса CRON    
> `service crond restart` — перезапуск CRON  

**Режим просмотра:**  
> `crontab -l` — просмотр содержимого существующего crontab файла (для текущего пользователя)  
> `crontab -l -uivan` — просмотр содержимого существующего crontab файла для пользователя "ivan"  
> `crontab -l -uroot` — просмотр содержимого существующего crontab файла для пользователя "root"    

**Режим редактирования:**  
> `crontab -e` — открыть файл crontab для изменений (если файла нет, будет создан новый)  
> `crontab -e -uivan` — открыть файл crontab для изменений для пользователя "ivan"  
> `crontab -e -uroot` — открыть файл crontab для изменений для пользователя "root"  
 
**Дополнительные режимы:**   
> `crontab -v` — Отобразит когда в последний раз Вы изменяли свой crontab файла.  
> `crontab -r` — Удалит Ваш crontab файл.  

**Примечание:**  

> В режиме редактирования файла crontab используются команды "VI редактора"     
> (для большинства хостингов):   

> `a`    — Режим вставки символа (внизу окна появляется подсказка --INSERT--)  
> `:`    — Ввод комманд (внизу окна появляется символ ":" и можно вводить команды)   
> `:wq`  — Выход с сохранением изменений (выход и режима редактирования)   

**Примечание: полный список комманд VI редактора можно посмотреть по ссылке:**   
http://citforum.ru/operating_systems/articles/tut_4.shtml   

**Пример файла crontab в режиме просмотра или редактирования:**    

> `01 * * * * command` - запуск программы или скрипта каждый час в одну минуту.
> `0 6 * * * command` - запуск программы или скрипта каждый день в 6 часов 0 минут утра
> `*/5 * * * * php /home/site/html/log.php` - запуск скрипта каждые 5 минут

**Описание синтаксиса:**   

```
* * * * * command  — сначала идет установка расписания (звездочки *), затем command - запускаемая программа или скрипт.
|  | |  | |
|  | |  | +----- День недели (0 - 6) (Sunday=0)
|  | |  +------- Месяц года (1 - 12)
|  | +--------- День месяца (1 - 31)
|  +----------- Час дня запуска (0 - 23)
+------------- Минута часа для запуска (0 - 59)
```

> Значения могут быть числом, трех-буквенным названием, а так же диапазоном   
> например запись «1-5» в поле day будет означать «с понедельника по пятницу».   

> Значения могут отделяться запятыми: «1,15,31» в поле day будет запускать,  
> указанную команду 1-го, 15-го и 31-го числа каждого месяца.   

> Все пять полей времени допускают использование символа звездочка – `*`,   
> который обозначает «использовать любое допустимое значение» для этого поля.  

**Примеры используемых команд:**    

> `wget -q -O- http://site.ru/tempius/test.php`         — запуск скипта по прямой http ссылке   
> `php /home/bitrix/www/site.ru/tempius/test.php`       — запуск скрипта PHP скрипта  
> `/home/local/test.sh`                                 — запуск bash скрипта  

> Содержимое файла `/home/local/test.sh`:
```
wget -q -O- http://site/test/script.php; 
``` 
> т.е. выполняется файл по прямой ссылке

**Полезные советы:**  

> Перед редактированием файла crontab можно запустить файл напрямую в консоли,    
> чтобы проверить, что файл точно работает, например:   

> `php /home/www/site.ru/test.php` — если скрипт отработал, в консоли увидим результат его работы   

### Если расписание не выполняется или выполняется с ошибками

1) Проверить правильность указания пути.  
2) Запустить файл через wget или php в консоли.   
3) Проверить наличие прав на файл и каталог, в котором расположен файл.   
4) Если в скрипте подключаются дополнительные файлы имеющие относительный путь, также возможны ошибки при адресации, необходимо указывать абсолютные пути к файлам.  
5) Если в файле исполняемого скрипта присутствуют серверные константы, например, `$_SERVER["DOCUMENT_ROOT"]`, их нужно переопределять вручную, например, для PHP:   

`$_SERVER["DOCUMENT_ROOT"] = "/home/www/site.ru/";`     

